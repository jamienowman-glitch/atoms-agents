<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Connector</title>
    <style>
        :root {
            --sidebar-bg: #f5f5f7;
            --accent: #0071e3;
            --border: #d2d2d7;
            --text: #1d1d1f;
        }

        body {
            margin: 0;
            display: flex;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text);
        }

        /* Sidebar */
        #sidebar {
            width: 300px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        h3 {
            margin: 0 0 10px 0;
            font-size: 13px;
            text-transform: uppercase;
            color: #86868b;
            letter-spacing: 0.5px;
        }

        /* Controls */
        label.row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        input[type="checkbox"] {
            accent-color: var(--accent);
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            font-size: 13px;
            transition: 0.2s;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: #0077ed;
        }

        .btn-danger {
            background: #ff3b30;
            color: white;
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--border);
        }

        /* Main Content */
        #main {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-on {
            background: #e6f4ea;
            color: #1e8e3e;
        }

        .status-off {
            background: #fce8e6;
            color: #c5221f;
        }

        /* List Items */
        .workspace-item {
            padding: 6px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
        }

        .workspace-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        /* Search Results */
        .result {
            background: white;
            border: 1px solid #eee;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .result:hover {
            border-color: var(--accent);
        }

        .snippet {
            font-family: monospace;
            font-size: 12px;
            color: #555;
            background: #f9f9f9;
            padding: 6px;
            border-radius: 4px;
            margin-top: 5px;
            overflow-x: auto;
        }

        /* File Preview */
        #preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            width: 80%;
            height: 80%;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        pre {
            flex-grow: 1;
            overflow: auto;
            background: #f5f5f7;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div id="sidebar">
        <div class="panel">
            <h3>Connection</h3>
            <div id="tunnel-ui">
                <div style="font-size: 12px; margin-bottom: 10px; color: #666;" id="tunnel-status">Stopped</div>
                <button class="btn btn-primary" id="btn-tunnel" onclick="toggleTunnel('start')">Start Tunnel</button>
                <div id="tunnel-url-box" style="margin-top:10px; display:none;">
                    <input type="text" readonly id="tunnel-url"
                        style="width:100%; padding:5px; font-size:11px; border:1px solid #ddd; border-radius:4px;">
                    <div style="font-size:10px; color:#888; margin-top:4px;">Copy to ChatGPT</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h3>Write Mode</h3>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span style="font-size:14px;">Enable Writes</span>
                <label class="switch">
                    <input type="checkbox" id="mode-toggle" onchange="toggleMode()">
                </label>
            </div>
            <div id="mode-timer" style="font-size:12px; color:#ff3b30; display:none;">Expires in <span
                    id="timer-val">60</span>m</div>
            <p style="font-size:11px; color:#86868b; margin-top:5px;">Writes blocked on main branch. Dry-run by default.
            </p>
        </div>

        <div class="panel" style="flex-grow: 1; display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Scope</h3>
                <button class="btn btn-outline" style="width:auto; padding:2px 6px; font-size:10px;"
                    onclick="refreshWorkspaces()">Refresh</button>
            </div>

            <div style="margin-bottom:10px;">
                <label class="row">
                    <span>Lock Scope</span>
                    <input type="checkbox" id="scope-lock" onchange="toggleLock()">
                </label>
            </div>

            <div id="workspace-list" style="overflow-y:auto; flex-grow:1;">
                <!-- workspaces -->
            </div>
        </div>

        <button class="btn btn-outline" onclick="runSelfTest()">Run Self-Test</button>
    </div>

    <div id="main">
        <h2 style="margin:0;">MCP Local Dev Connector</h2>

        <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.05);">
            <div style="display:flex; gap:10px;">
                <input type="text" id="search-query" placeholder="Search across active scope (regex supported)..."
                    style="flex-grow:1; padding:10px; border-radius:6px; border:1px solid #d2d2d7; font-size:14px;">
                <input type="text" id="glob" placeholder="*.py"
                    style="width:100px; padding:10px; border-radius:6px; border:1px solid #d2d2d7;">
                <button class="btn btn-primary" style="width:auto;" onclick="search()">Search</button>
            </div>
        </div>

        <div id="results-area"></div>
    </div>

    <div id="preview-modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h3 id="preview-title" style="margin:0;">File.py</h3>
                <button class="btn btn-outline" style="width:auto;" onclick="closePreview()">Close</button>
            </div>
            <pre><code id="preview-code"></code></pre>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>